.\" Automatically generated by Pod::Man 2.23 (Pod::Simple 3.14)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.ie \nF \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    nr % 0
.    rr F
.\}
.el \{\
.    de IX
..
.\}
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "BACKUP_VOLSETRESTORE 8"
.TH BACKUP_VOLSETRESTORE 8 "2011-09-06" "OpenAFS" "AFS Command Reference"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
backup_volsetrestore \- Restores all volumes in a volume set
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
\&\fBbackup volsetrestore\fR [\fB\-name\fR\ <\fIvolume\ set\ name\fR>]
    [\fB\-file\fR\ <\fIfile\ name\fR>]
    [\fB\-portoffset\fR\ <\fI\s-1TC\s0\ port\ offset\fR>+]
    [\fB\-extension\fR\ <\fInew\ volume\ name\ extension\fR>] [\fB\-n\fR]
    [\fB\-localauth\fR] [\fB\-cell\fR\ <\fIcell\ name\fR>] [\fB\-help\fR]
.PP
\&\fBbackup vols\fR [\fB\-na\fR\ <\fIvolume\ set\ name\fR>]
    [\fB\-f\fR\ <\fIfile\ name\fR>]
    [\fB\-p\fR\ <\fI\s-1TC\s0\ port\ offset\fR>+]
    [\fB\-e\fR\ <\fInew\ volume\ name\ extension\fR>]
    [\fB\-n\fR] [\fB\-l\fR] [\fB\-c\fR\ <\fIcell\ name\fR>] [\fB\-h\fR]
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
The \fBbackup volsetrestore\fR command restores the complete contents of a
group of read/write volumes to the file system, by restoring data from the
last full dump and all subsequent incremental dumps of each volume.  It is
most useful for recovering from loss of data on multiple partitions, since
it can restore each of a defined set of volumes to a different site.
.PP
(If the \f(CW\*(C`FILE YES\*(C'\fR instruction appears in the
\&\fI/usr/afs/backup/CFG_\fIdevice_name\fI\fR file associated with the specified
port offset, then the \fBbackup volsetrestore\fR command restores data from
the backup data file listed for that port offset in the Tape Coordinator's
\&\fI/usr/afs/backup/tapeconfig\fR file, instead of from tape. For the sake of
clarity, the following text refers to tapes only, but the Backup System
handles backup data files in much the same way.)
.PP
If restoring one or more volumes to a single site only, it is usually more
efficient to use the \fBbackup volrestore\fR command. If restoring all
volumes that resided on a single partition, it is usually more efficient
to use the \fBbackup diskrestore\fR command.
.PP
Indicate the volumes to restore by providing either the \fB\-name\fR argument
or the \fB\-file\fR argument:
.IP "\(bu" 4
The \fB\-name\fR argument names a volume set. The Backup System restores all
volumes listed in the Volume Location Database (\s-1VLDB\s0) that match the
server, partition, and volume name criteria defined in the volume set's
volume entries, and for which dumps are available. It restores the volumes
to their current site (machine and partition), and by default overwrites
the existing volume contents.
.Sp
It is not required that the volume set was previously used to back up
volumes (was used as the \fB\-volumeset\fR option to the \fBbackup dump\fR
command). It can be defined especially to match the volumes that need to
be restored with this command, and that is usually the better
choice. Indeed, a \fItemporary\fR volume set, created by including the
\&\fB\-temporary\fR flag to the \fBbackup addvolset\fR command, can be especially
useful in this context. A temporary volume set is not added to the Backup
Database and exists only during the current interactive backup session,
which is suitable if the volume set is needed only to complete the single
restore operation initialized by this command.
.Sp
The reason that a specially defined volume set is probably better is that
volume sets previously defined for use in dump operations usually match
the backup version of volumes, whereas for a restore operation it is best
to define volume entries that match the base (read/write) name. In that
case, the Backup System searches the Backup Database for the newest dump
set that includes either the read/write or the backup version of the
volume. If, in contrast, a volume entry explicitly matches the volume's
backup or read-only version, the Backup System restores dumps of that
volume version only.
.IP "\(bu" 4
The \fB\-file\fR argument names a file that lists specific volumes and the
site to which to restore each. The volume name must match the name used in
Backup Database dump records rather than in the \s-1VLDB\s0, if they differ,
because the Backup System does not look up volumes in the \s-1VLDB\s0. The
specified site can be different than the volume's current one; in that
case, the Backup System removes the current version of the volume and
updates the volume's location information in the \s-1VLDB\s0.
.PP
If all of the full and incremental dumps of all relevant volumes were not
written to a type of tape that a single Tape Coordinator can read, use the
\&\fB\-portoffset\fR argument to list multiple port offset numbers in the order
in which the tapes are needed (first list the port offset for the full
dump, second the port offset for the level 1 incremental dump, and so
on). This implies that the full dumps of all relevant volumes must have
been written to a type of tape that the first Tape Coordinator can read,
the level 1 incremental dumps to a type of tape the second Tape
Coordinator can read, and so on. If dumps are on multiple incompatible
tape types, use the \fBbackup volrestore\fR command to restore individual
volumes, or use this command after defining new volume sets that group
together volumes that were dumped to compatible tape types. For further
discussion, see the \fIOpenAFS Administration Guide\fR.
.PP
By default, the Backup System overwrites the contents of an existing
volume with the restored data. To create a new volume to house the
restored version instead, use the \fB\-extension\fR argument. The Backup
System derives the new volume's name by adding the specified extension to
the read/write base name, and creates a new \s-1VLDB\s0 entry. The command does
not affect the existing volume in any way. However, if a volume with the
specified extension also already exists, the command overwrites it.
.PP
The \fB\-n\fR flag produces a list of the volumes to be restored if the \fB\-n\fR
flag were not included, without actually restoring any volumes. See
\&\s-1OUTPUT\s0 for a detailed description of the output, and suggestions on how
to combine it most effectively with the \fB\-file\fR and \fB\-name\fR arguments.
.PP
The execution time for a \fBbackup volsetrestore\fR command depends on the
number of volumes to be restored and the amount of data in them, but it
can take hours to restore a large number of volumes. One way to reduce the
time is to run multiple instances of the command simultaneously, either
using the \fB\-name\fR argument to specify disjoint volume sets for each
command, or the \fB\-file\fR argument to name files that list different
volumes. This is possible if there are multiple available Tape
Coordinators that can read the required tapes. Depending on how the
volumes to be restored were dumped to tape, specifying disjoint volume
sets can also reduce the number of tape changes required.
.PP
The Tape Coordinator's default response to this command is to access the
first tape it needs by invoking the \f(CW\*(C`MOUNT\*(C'\fR instruction in the local
\&\fI/usr/afs/backup/CFG_\fIdevice_name\fI\fR file, or by prompting the backup
operator to insert the tape if there is no \f(CW\*(C`MOUNT\*(C'\fR instruction. However,
if the \f(CW\*(C`AUTOQUERY NO\*(C'\fR instruction appears in the \fI\s-1CFG_\s0\fIdevice_name\fI\fR
file, or if the issuer of the \fBbutc\fR command included the \fB\-noautoquery\fR
flag, the Tape Coordinator instead expects the tape to be in the device
already. If it is not, or is the wrong tape, the Tape Coordinator invokes
the \f(CW\*(C`MOUNT\*(C'\fR instruction or prompts the operator. It also invokes the
\&\f(CW\*(C`MOUNT\*(C'\fR instruction or prompts for any additional tapes needed to
complete the restore operation; the backup operator must arrange to
provide them.
.SH "OPTIONS"
.IX Header "OPTIONS"
.IP "\fB\-name\fR <\fIvolume set name\fR>" 4
.IX Item "-name <volume set name>"
Names a volume set to restore. The Backup System restores all of the
volumes listed in the \s-1VLDB\s0 that match the volume set's volume
entries. Provide this argument or the \fB\-file\fR argument, but not both.
.IP "\fB\-file\fR <\fIfile name\fR>" 4
.IX Item "-file <file name>"
Specifies the full pathname of a file that lists one or more volumes and
the site (file server machine and partition) to which to restore each.
Use either this argument or the \fB\-name\fR argument, but not both.
.Sp
Each volume's entry must appear on its own (unbroken) line in the file,
and have the following format:
.Sp
.Vb 1
\&    <machine> <partition> <volume> [<comments> ...]
.Ve
.Sp
where
.RS 4
.IP "<machine>" 4
.IX Item "<machine>"
Names the file server machine to which to restore the volume.
.IP "<partition>" 4
.IX Item "<partition>"
Names the partition to which to restore the volume.
.IP "<volume>" 4
.IX Item "<volume>"
Names the volume to restore. It is generally best to specify the base
(read/write) name of each volume. In this case, the Backup System searches
the Backup Database for the newest dump set that includes a dump of either
the read/write or the backup version of the volume. It restores the dumps
of that version of the volume, starting with the most recent full
dump. If, in contrast, the name explicitly includes the \f(CW\*(C`.backup\*(C'\fR or
\&\f(CW\*(C`.readonly\*(C'\fR extension, the Backup System restores dumps of that volume
version only.
.IP "<comments> ..." 4
.IX Item "<comments> ..."
Is any other text. The Backup System ignores any text on each line that
appears after the volume name, so this field can be used for notes helpful
to the backup operator or other administrator.
.RE
.RS 4
.Sp
Do not use wildcards (for example, \f(CW\*(C`.*\*(C'\fR) in the <machine>, <partition>,
or <volume> fields. It is acceptable for multiple lines in the file to
name the same volume, but the Backup System processes only the first of
them.
.RE
.IP "\fB\-extension\fR <\fInew volume name extension\fR>" 4
.IX Item "-extension <new volume name extension>"
Creates a new volume for each volume specified by the \fB\-name\fR or \fB\-file\fR
argument, to house the restored data from that volume.  The Backup System
derives the new volume's name by appending the specified string to the
read/write base name, and creates a new \s-1VLDB\s0 volume entry. It preserves
the contents of each existing volume. Any string other than \f(CW\*(C`.readonly\*(C'\fR
or \f(CW\*(C`.backup\*(C'\fR is acceptable, but the combination of the base name and
extension cannot exceed 22 characters in length. To use a period to
separate the extension from the name, specify it as the first character of
the string (as in \f(CW\*(C`.rst\*(C'\fR, for example).
.IP "\fB\-portoffset\fR <\fI\s-1TC\s0 port offset\fR>+" 4
.IX Item "-portoffset <TC port offset>+"
Specifies one or more port offset numbers (up to a maximum of 128), each
corresponding to a Tape Coordinator to use in the operation. If there is
more than one value, the Backup System uses the first one when restoring
the full dump of each volume, the second one when restoring the level 1
incremental dump of each volume, and so on. It uses the final value in the
list when restoring dumps at the corresponding depth in the dump hierarchy
and all dumps at lower levels.
.Sp
Provide this argument unless the default value of 0 (zero) is appropriate
for all dumps. If \f(CW0\fR is just one of the values in the list, provide it
explicitly in the appropriate order.
.IP "\fB\-n\fR" 4
.IX Item "-n"
Displays a list of the volumes to be restored if the flag were not
included, without actually restoring them. \s-1OUTPUT\s0 details the format of
the output. When combined with the \fB\-name\fR argument, its output is easily
edited for use as input to the \fB\-file\fR argument on a subsequent \fBbackup
volsetrestore\fR command.
.IP "\fB\-localauth\fR" 4
.IX Item "-localauth"
Constructs a server ticket using a key from the local
\&\fI/usr/afs/etc/KeyFile\fR file. The \fBbackup\fR command interpreter presents
it to the Backup Server, Volume Server and \s-1VL\s0 Server during mutual
authentication. Do not combine this flag with the \fB\-cell\fR argument. For
more details, see \fIbackup\fR\|(8).
.IP "\fB\-cell\fR <\fIcell name\fR>" 4
.IX Item "-cell <cell name>"
Names the cell in which to run the command. Do not combine this argument
with the \fB\-localauth\fR flag. For more details, see \fIbackup\fR\|(8).
.IP "\fB\-help\fR" 4
.IX Item "-help"
Prints the online help for this command. All other valid options are
ignored.
.SH "OUTPUT"
.IX Header "OUTPUT"
If the \fB\-n\fR flag is not provided, the command displays a unique task \s-1ID\s0
number for the operation, in two places:
.IP "\(bu" 4
In the shell window, directly following the command line.
.IP "\(bu" 4
In the Tape Coordinator window, if the butc process was started at debug
level 1.
.PP
The task \s-1ID\s0 number is not the same as the job \s-1ID\s0 number displayed by the
\&\fBbackup jobs\fR command when the \fBbackup volsetrestore\fR command is issued
in interactive mode. The Backup System does not assign either type of \s-1ID\s0
number until the restoration process actually begins.
.PP
When the \fB\-n\fR flag is included, no task \s-1ID\s0 or job \s-1ID\s0 numbers are reported
because none are assigned. Instead, the output begins with a count of the
number of volumes to be restored, followed by a line for each dump of a
volume. For each volume, the line representing the most recent full dump
appears first, and lines for any subsequent incremental dumps follow,
ordered by dump level. The lines for a given volume do not necessarily
appear all together, however.
.PP
The format of each line is as follows (the output is shown here on two
lines only for legibility reasons):
.PP
.Vb 2
\&   <machine> <partition> <volume_dumped> # as <volume_restored>; \e
\&       <tape_name> (<tape_ID>); pos <position_number>; <date>
.Ve
.PP
where
.IP "<machine>" 4
.IX Item "<machine>"
Names the file server machine that currently houses the volume, as listed
in the \s-1VLDB\s0.
.IP "<partition>" 4
.IX Item "<partition>"
Names the partition that currently houses the volume, as listed in the
\&\s-1VLDB\s0.
.IP "<volume_dumped>" 4
.IX Item "<volume_dumped>"
Specifies the version (read/write or backup) of the volume that was
dumped, as listed in the Backup Database.
.IP "<volume_restored>" 4
.IX Item "<volume_restored>"
Specifies the name under which to restore the volume. The Backup System
only restores data to read/write volumes. If the \fB\-extension\fR argument is
included, then the specified extension appears on the name in this field
(for example, \f(CW\*(C`user.pat.rst\*(C'\fR).
.IP "<tape_name>" 4
.IX Item "<tape_name>"
Names the tape containing the dump of the volume, from the Backup
Database. If the tape has a permanent name, it appears here; otherwise, it
is the \s-1AFS\s0 tape name.
.IP "<tape_ID>" 4
.IX Item "<tape_ID>"
The tape \s-1ID\s0 of the tape containing the dump of the volume, from the Backup
Database.
.IP "<position_number>" 4
.IX Item "<position_number>"
Specifies the dump's position on the tape (for example, \f(CW31\fR indicates
that 30 volume dumps precede the current one on the tape). If the dump was
written to a backup data file, this number is the ordinal of the 16
KB-offset at which the volume's data begins.
.IP "<date>" 4
.IX Item "<date>"
The date and time when the volume was dumped.
.PP
One way to generate a file for use as input to the \fB\-file\fR argument is to
combine the \fB\-name\fR and \fB\-n\fR options, directing the output to a
file. The \fIOpenAFS Administration Guide\fR section on using the Backup
System to restore data explains how to edit the file as necessary before
using it as input to the \fB\-file\fR argument.
.PP
The output of this command includes only volumes for which the Backup
Database includes at least one dump record. The command interpreter
generates a message on the standard error stream about volumes that do not
have dump records but either are listed in the file named by the \fB\-file\fR
argument, or appear in the \s-1VLDB\s0 as a match to a volume entry in the volume
set named by the \fB\-name\fR argument.
.SH "EXAMPLES"
.IX Header "EXAMPLES"
The following command restores all volumes included in entries in the
volume set named \f(CW\*(C`data.restore\*(C'\fR, which was created expressly to restore
data to a pair of file server machines on which all data was corrupted due
to a software error. All volumes are restored to the sites recorded in
their entries in the \s-1VLDB\s0.
.PP
.Vb 4
\&   % backup volsetrestore \-name data.restore
\&   Starting restore
\&   backup: task ID of restore operation: 112
\&   backup: Finished doing restore
.Ve
.PP
The following command restores all volumes that have entries in the file
named \fI/tmp/restore\fR:
.PP
.Vb 4
\&   % backup volsetrestore \-file /tmp/restore
\&   Starting restore
\&   backup: task ID of restore operation: 113
\&   backup: Finished doing restore
.Ve
.PP
The \fI/tmp/restore\fR file has the following contents:
.PP
.Vb 6
\&   fs1.abc.com b user.pat
\&   fs1.abc.com b user.terry
\&   fs1.abc.com b user.smith
\&   fs2.abc.com c user.jones
\&          .         .     .
\&          .         .     .
.Ve
.SH "PRIVILEGE REQUIRED"
.IX Header "PRIVILEGE REQUIRED"
The issuer must be listed in the \fI/usr/afs/etc/UserList\fR file on every
machine where the Backup Server or Volume Location (\s-1VL\s0) Server is running,
and on every file server machine that houses an affected volume. If the
\&\fB\-localauth\fR flag is included, the issuer must instead be logged on to a
server machine as the local superuser \f(CW\*(C`root\*(C'\fR.
.SH "SEE ALSO"
.IX Header "SEE ALSO"
\&\fIbutc\fR\|(5),
\&\fIbackup\fR\|(8),
\&\fIbackup_addvolentry\fR\|(8),
\&\fIbackup_addvolset\fR\|(8),
\&\fIbackup_diskrestore\fR\|(8),
\&\fIbackup_dump\fR\|(8),
\&\fIbackup_volrestore\fR\|(8),
\&\fIbutc\fR\|(8)
.SH "COPYRIGHT"
.IX Header "COPYRIGHT"
\&\s-1IBM\s0 Corporation 2000. <http://www.ibm.com/> All Rights Reserved.
.PP
This documentation is covered by the \s-1IBM\s0 Public License Version 1.0.  It was
converted from \s-1HTML\s0 to \s-1POD\s0 by software written by Chas Williams and Russ
Allbery, based on work by Alf Wachsmann and Elizabeth Cassell.
