.\" Automatically generated by Pod::Man 2.16 (Pod::Simple 3.05)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sh \" Subsection heading
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.Sh), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.ie \nF \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    nr % 0
.    rr F
.\}
.el \{\
.    de IX
..
.\}
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "BACKUP_VOLRESTORE 8"
.TH BACKUP_VOLRESTORE 8 "2010-12-15" "OpenAFS" "AFS Command Reference"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
backup_volrestore \- Restores one or more volumes
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
\&\fBbackup volrestore\fR \fB\-server\fR\ <\fIdestination\ machine\fR>
    \fB\-partition\fR\ <\fIdestination\ partition\fR>
    \fB\-volume\fR\ <\fIvolume(s)\ to\ restore\fR>+
    [\fB\-extension\fR\ <\fInew\ volume\ name\ extension\fR>]
    [\fB\-date\fR\ <\fIdate\ from\ which\ to\ restore\fR>+]
    [\fB\-portoffset\fR\ <\fI\s-1TC\s0\ port\ offsets\fR>+] [\fB\-n\fR]
    [\fB\-usedump\fR\ <\fIspecify\ the\ dumpID\ to\ restore\ from\fR>]
    [\fB\-localauth\fR] [\fB\-cell\fR\ <\fIcell\ name\fR>] [\fB\-help\fR]
.PP
\&\fBbackup volr\fR \fB\-s\fR\ <\fIdestination\ machine\fR>
    \fB\-pa\fR\ <\fIdestination\ partition\fR>
    \fB\-v\fR\ <\fIvolume(s)\ to\ restore\fR>+
    [\fB\-e\fR\ <\fInew\ volume\ name\ extension\fR>]
    [\fB\-d\fR\ <\fIdate\ from\ which\ to\ restore\fR>+]
    [\fB\-po\fR\ <\fI\s-1TC\s0\ port\ offsets\fR>+]
    [\fB\-u\fR\ <\fIspecify\ the\ dumpID\ to\ restore\ from\fR>]
    [\fB\-n\fR] [\fB\-l\fR] [\fB\-c\fR\ <\fIcell\ name\fR>] [\fB\-h\fR]
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
The \fBbackup volrestore\fR command restores the contents of one or more
volumes to the site indicated by the \fB\-server\fR and \fB\-partition\fR
arguments. Use the command either to overwrite the contents of existing
volumes with the restored data or to create new volumes while retaining
the existing ones. The specified site does not have to be the current site
for the volumes.
.PP
(If the \f(CW\*(C`FILE YES\*(C'\fR instruction appears in the
\&\fI/usr/afs/backup/CFG_\fIdevice_name\fI\fR file associated with the specified
port offset, then the \fBbackup volrestore\fR command restores data from the
backup data file listed for that port offset in the Tape Coordinator's
\&\fI/usr/afs/backup/tapeconfig\fR file, rather than from tape. For the sake of
clarity, the following text refers to tapes only, but the Backup System
handles backup data files in much the same way.)
.PP
The command's arguments can be combined as indicated:
.IP "\(bu" 4
To preserve a volume's current contents and also create a new volume to
house the restored version, use the \fB\-extension\fR argument.  The Backup
System creates the new volume on the server and partition named by the
\&\fB\-server\fR and \fB\-partition\fR arguments, assigns it the same name as the
current volume with the addition of the specified extension, and creates a
new Volume Location Database (\s-1VLDB\s0) entry for it.  Creating a new volume
enables the administrator to compare the two versions.
.IP "\(bu" 4
To overwrite a volume's existing contents with the restored version, omit
the \fB\-extension\fR argument, and specify the site as indicated:
.RS 4
.IP "\(bu" 4
To retain the current site, specify it with the \fB\-server\fR and
\&\fB\-partition\fR arguments.
.IP "\(bu" 4
To move the volume to a different site while overwriting it, specify the
new site with the \fB\-server\fR argument, \fB\-partition\fR argument, or
both. The Backup System creates a new volume at that site, removes the
existing volume, and updates the site information in the volume's \s-1VLDB\s0
entry. The backup version of the volume is not removed automatically from
the original site, if it exists. Use the \fBvos remove\fR command to remove
it and the \fBvos backup\fR command to create a backup version at the new
site.
.RE
.RS 4
.RE
.IP "\(bu" 4
To restore a volume that no longer exists in the file system, specify its
name with the \fB\-volume\fR argument and use the \fB\-server\fR and \fB\-partition\fR
arguments to place it at the desired site. The Backup System creates a new
volume and new \s-1VLDB\s0 entry.
.PP
In each case, the command sets each volume's creation date to the date and
time at which it restores it. The creation date appears in the \f(CW\*(C`Creation\*(C'\fR
field in the output from the \fBvos examine\fR and \fBvos listvol\fR commands.
.PP
If restoring all of the volumes that resided on a single partition, it is
usually more efficient to use the \fBbackup diskrestore\fR command. If
restoring multiple volumes to many different sites, it can be more
efficient to use the \fBbackup volsetrestore\fR command.
.PP
By default, the backup volrestore command restores the most recent full
dump and all subsequent incremental dumps for each volume, bringing the
restored volumes to the most current possible state. To restore the
volumes to their state at some time in the past, use the \fB\-date\fR
argument. The Backup System restores the most recent full dump and each
subsequent incremental dump for which the \fIclone date\fR of the volume
included in the dump is before the indicated date and time (the clone date
timestamp appears in the \f(CW\*(C`clone date\*(C'\fR field of the output from the
\&\fBbackup volinfo\fR command). For backup and read-only volumes, the clone
date represents the time at which the volume was copied from its
read/write source; for read/write volumes, it represents the time at which
the volume was locked for inclusion in the dump. The resemblance of a
restored volume to its actual state at the indicated time depends on the
amount of time that elapsed between the volume's clone date in the last
eligible dump and the specified time.
.PP
If the \fB\-volume\fR argument specifies the base (read/write) form of the
volume name, the Backup System searches the Backup Database for the newest
dump set that includes a dump of either the read/write or the backup
version of the volume. It restores the dumps of that version of the
volume, starting with the most recent full dump. If, in contrast, the
volume name explicitly includes the \f(CW\*(C`.backup\*(C'\fR or \f(CW\*(C`.readonly\*(C'\fR extension,
the Backup System restores dumps of the corresponding volume version only.
.PP
To generate a list of the tapes the Backup System needs to perform the
restore operation, without actually performing it, combine the \fB\-n\fR flag
with the options to be used on the actual command.
.PP
If all of the full and incremental dumps of all relevant volumes were not
written to a type of tape that a single Tape Coordinator can read, use the
\&\fB\-portoffset\fR argument to list multiple port offset numbers in the order
in which the tapes are needed (first list the port offset for the full
dump, second the port offset for the level 1 incremental dump, and so
on). If restoring multiple volumes, the same ordered list of port offsets
must apply to all of them. If not, either issue this command separately
for each volume, or use the \fBvos volsetrestore\fR command after defining
groups of volumes that were dumped to compatible tape types. For further
discussion, see the \fIOpenAFS Administration Guide\fR.
.PP
The Tape Coordinator's default response to this command is to access the
first tape it needs by invoking the \fB\s-1MOUNT\s0\fR instruction in the local
\&\fI/usr/afs/backup/CFG_\fIdevice_name\fI\fR file, or by prompting the backup
operator to insert the tape if there is no \f(CW\*(C`MOUNT\*(C'\fR instruction. However,
if the \f(CW\*(C`AUTOQUERY NO\*(C'\fR instruction appears in the \fI\s-1CFG_\s0\fIdevice_name\fI\fR
file, or if the issuer of the \fBbutc\fR command included the \fB\-noautoquery\fR
flag, the Tape Coordinator instead expects the tape to be in the device
already. If it is not, or is the wrong tape, the Tape Coordinator invokes
the \f(CW\*(C`MOUNT\*(C'\fR instruction or prompts the operator. It also invokes the
\&\f(CW\*(C`MOUNT\*(C'\fR instruction or prompts for any additional tapes needed to
complete the restore operation; the backup operator must arrange to
provide them.
.SH "OPTIONS"
.IX Header "OPTIONS"
.IP "\fB\-server\fR <\fIdestination machine\fR>" 4
.IX Item "-server <destination machine>"
Names the file server machine on which to restore each volume. If this
argument and the \fB\-partition\fR argument indicate a site other than the
current site for each volume, and the \fB\-extension\fR argument is not also
provided, the Backup System removes the existing volumes from their
current sites, places the restored contents at the specified site, and
changes the site information in the volume's \s-1VLDB\s0 entry.
.IP "\fB\-partition\fR <\fIdestination partition\fR>" 4
.IX Item "-partition <destination partition>"
Names the partition to which to restore each volume. If this argument and
the \fB\-server\fR argument indicate a site other than the current site for
each volume, and the \fB\-extension\fR argument is not also provided, the
Backup System removes the existing volumes from their current sites,
places the restored contents at the specified site, and changes the site
information in the volume's \s-1VLDB\s0 entry.
.IP "\fB\-volume\fR <\fIvolume to restore\fR>+" 4
.IX Item "-volume <volume to restore>+"
Names one or more volumes to restore, using the volume name as listed in
the Backup Database. Provide the base (read/write) name of each volume to
have the Backup System search the Backup Database for the newest dump set
that includes a dump of either the read/write or the backup version of the
volume; it restores the dumps of that version of the volume, starting with
the most recent full dump. If, in contrast, a volume name explicitly
includes the \f(CW\*(C`.backup\*(C'\fR or \f(CW\*(C`.readonly\*(C'\fR extension, the Backup System
restores dumps of the corresponding volume version only.
.IP "\fB\-extension\fR <\fInew volume name extension\fR>" 4
.IX Item "-extension <new volume name extension>"
Creates a new volume to house the restored data, with a name derived by
appending the specified string to each volume named by the \fB\-volume\fR
argument. The Backup System creates a new \s-1VLDB\s0 entry for the volume. Any
string other than \f(CW\*(C`.readonly\*(C'\fR or \f(CW\*(C`.backup\*(C'\fR is acceptable, but the
combination of the existing volume name and extension cannot exceed 22
characters in length. To use a period to separate the extension from the
name, specify it as the first character of the string (as in \f(CW\*(C`.rst\*(C'\fR, for
example).
.IP "\fB\-date\fR <\fIdate from which to restore\fR>+" 4
.IX Item "-date <date from which to restore>+"
Specifies a date and optionally time; the restored volume includes data
from dumps performed before the date only. Provide a value in the format
\&\fImm/dd/yyyy\fR [\fIhh\fR:\fI\s-1MM\s0\fR], where the required \fImm/dd/yyyy\fR portion
indicates the month (\fImm\fR), day (\fIdd\fR), and year (\fIyyyy\fR), and the
optional \fIhh:MM\fR portion indicates the hour and minutes in 24\-hour format
(for example, the value \f(CW\*(C`14:36\*(C'\fR represents 2:36 p.m.). If omitted, the
time defaults to 59 seconds after midnight (00:00:59 hours).
.Sp
Valid values for the year range from \f(CW1970\fR to \f(CW2037\fR; higher values are
not valid because the latest possible date in the standard \s-1UNIX\s0
representation is in February 2038. The command interpreter automatically
reduces any later date to the maximum value.
.Sp
If this argument is omitted, the Backup System restores all possible dumps
including the most recently created.
.IP "\fB\-portoffset\fR <\fI\s-1TC\s0 port offest\fR>+" 4
.IX Item "-portoffset <TC port offest>+"
Specifies one or more port offset numbers (up to a maximum of 128), each
corresponding to a Tape Coordinator to use in the operation. If there is
more than one value, the Backup System uses the first one when restoring
the full dump of each volume, the second one when restoring the level 1
incremental dump of each volume, and so on. It uses the final value in the
list when restoring dumps at the corresponding depth in the dump hierarchy
and all dumps at lower levels.
.Sp
Provide this argument unless the default value of 0 (zero) is appropriate
for all dumps. If \f(CW0\fR is just one of the values in the list, provide it
explicitly in the appropriate order.
.IP "\fB\-n\fR" 4
.IX Item "-n"
Displays the list of tapes that contain the dumps required by the restore
operation, without actually performing the operation.
.IP "\fB\-localauth\fR" 4
.IX Item "-localauth"
Constructs a server ticket using a key from the local
\&\fI/usr/afs/etc/KeyFile\fR file. The \fBbackup\fR command interpreter presents
it to the Backup Server, Volume Server and \s-1VL\s0 Server during mutual
authentication. Do not combine this flag with the \fB\-cell\fR argument. For
more details, see \fIbackup\fR\|(8).
.IP "\fB\-cell\fR <\fIcell name\fR>" 4
.IX Item "-cell <cell name>"
Names the cell in which to run the command. Do not combine this argument
with the \fB\-localauth\fR flag. For more details, see \fIbackup\fR\|(8).
.IP "\fB\-help\fR" 4
.IX Item "-help"
Prints the online help for this command. All other valid options are
ignored.
.SH "OUTPUT"
.IX Header "OUTPUT"
If the issuer includes the \fB\-n\fR flag with the command, the following
string appears at the head of the list of the tapes necessary to complete
the restore operation.
.PP
.Vb 1
\&   Tapes needed:
.Ve
.SH "EXAMPLES"
.IX Header "EXAMPLES"
The following command restores the volume user.pat to partition \fI/vicepa\fR
on machine \f(CW\*(C`fs5.abc.com\*(C'\fR:
.PP
.Vb 1
\&   % backup volrestore \-server fs5.abc.com \-partition a \-volume user.pat
.Ve
.PP
The following command restores the volumes \f(CW\*(C`user.smith\*(C'\fR and \f(CW\*(C`user.terry\*(C'\fR
to partition \fI/vicepb\fR on machine \f(CW\*(C`fs4.abc.com\*(C'\fR, adding a \f(CW\*(C`.rst\*(C'\fR
extension to each volume name and preserving the existing \f(CW\*(C`user.smith\*(C'\fR
and \f(CW\*(C`user.terry\*(C'\fR volumes.  Only dumps created before 5:00 p.m. on 31
January 1998 are restored. (The command is shown here on multiple lines
only for legibility reasons.)
.PP
.Vb 3
\&   % backup volrestore \-server fs4.abc.com \-partition b  \e
\&                       \-volume user.smith user.terry  \e
\&                       \-extension .rst \-date 1/31/1998 17:00
.Ve
.PP
The following command restores the volume user.pat to partition \fI/vicepb\fR
on machine \f(CW\*(C`fs4.abc.com\*(C'\fR. The Tape Coordinator with port offset 1 handles
the tape containing the full dump; the Tape Coordinator with port offset 0
handles all tapes containing incremental dumps. (The command is shown here
on two lines only for legibility reasons.)
.PP
.Vb 2
\&   % backup volrestore \-server fs5.abc.com \-partition a  \e
\&                       \-volume user.pat \-portoffset 1 0
.Ve
.SH "PRIVILEGE REQUIRED"
.IX Header "PRIVILEGE REQUIRED"
The issuer must be listed in the \fI/usr/afs/etc/UserList\fR file on every
machine where the Backup Server or Volume Location (\s-1VL\s0) Server is running,
and on every file server machine that houses an affected volume. If the
\&\fB\-localauth\fR flag is included, the issuer must instead be logged on to a
server machine as the local superuser \f(CW\*(C`root\*(C'\fR.
.SH "SEE ALSO"
.IX Header "SEE ALSO"
\&\fIbutc\fR\|(5),
\&\fIbackup\fR\|(8),
\&\fIbackup_dump\fR\|(8),
\&\fIbackup_diskrestore\fR\|(8),
\&\fIbackup_volsetrestore\fR\|(8),
\&\fIbutc\fR\|(8),
\&\fIvos_backup\fR\|(1),
\&\fIvos_remove\fR\|(1)
.SH "COPYRIGHT"
.IX Header "COPYRIGHT"
\&\s-1IBM\s0 Corporation 2000. <http://www.ibm.com/> All Rights Reserved.
.PP
This documentation is covered by the \s-1IBM\s0 Public License Version 1.0.  It was
converted from \s-1HTML\s0 to \s-1POD\s0 by software written by Chas Williams and Russ
Allbery, based on work by Alf Wachsmann and Elizabeth Cassell.
