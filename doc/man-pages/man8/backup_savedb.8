.\" Automatically generated by Pod::Man 2.23 (Pod::Simple 3.14)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.ie \nF \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    nr % 0
.    rr F
.\}
.el \{\
.    de IX
..
.\}
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "BACKUP_SAVEDB 8"
.TH BACKUP_SAVEDB 8 "2011-09-06" "OpenAFS" "AFS Command Reference"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
backup_savedb \- Creates a saved copy of the Backup Database
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
\&\fBbackup savedb\fR [\fB\-portoffset\fR\ <\fI\s-1TC\s0\ port\ offset\fR>]
    [\fB\-archive\fR\ <\fIdate\ time\fR>+] [\fB\-localauth\fR]
    [\fB\-cell\fR\ <\fIcell\ name\fR>] [\fB\-help\fR]
.PP
\&\fBbackup sa\fR [\fB\-p\fR\ <\fI\s-1TC\s0\ port\ offset\fR>]
    [\fB\-a\fR\ <\fIdate\ time\fR>+]
    [\fB\-l\fR] [\fB\-c\fR\ <\fIcell\ name\fR>] [\fB\-h\fR]
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
The \fBbackup savedb\fR command creates a backup copy of the entire Backup
Database and writes it to the tape in the device controlled by the Tape
Coordinator indicated with the \fB\-portoffset\fR argument. If the database is
damaged (as reported by the \fBbackup dbverify\fR command), this command
repairs as much of the corruption as possible as it creates the saved
copy. The Backup Server creates a dump record for the saved database in
the Backup Database (but in the disk version of the database only, not in
the version written to tape).
.PP
If the \f(CW\*(C`FILE YES\*(C'\fR instruction appears in the
\&\fI/usr/afs/backup/CFG_\fIdevice_name\fI\fR file associated with the specified
port offset, then the \fBbackup savedb\fR command dumps the database copy to
the backup data file listed for that port offset in the Tape Coordinator's
\&\fI/usr/afs/backup/tapeconfig\fR file, instead of to tape. For the sake of
clarity, the following text refers to tapes only, but the Backup System
handles backup data files in much the same way.
.PP
If the \fB\-archive\fR flag is provided, after writing the saved copy of the
database the Backup System truncates the copy of the database on disk by
deleting volume dump records with timestamps prior to the specified date
and time (it does not delete the dump records created by previous \fBbackup
savedb\fR commands, however).
.PP
If the tape to which the database copy is written has an \s-1AFS\s0 tape name, it
must be \f(CW\*(C`Ubik_db_dump.1\*(C'\fR or \f(CW\*(C`<NULL>\*(C'\fR. Any permanent name is
acceptable.
.PP
The Tape Coordinator's default response to this command is to access the
first tape by invoking the \f(CW\*(C`MOUNT\*(C'\fR instruction in the local
\&\fI/usr/afs/backup/CFG_\fIdevice_name\fI\fR file, or by prompting the backup
operator to insert the tape if there is no \f(CW\*(C`MOUNT\*(C'\fR instruction. However,
if the \f(CW\*(C`AUTOQUERY NO\*(C'\fR instruction appears in the \fI\s-1CFG_\s0\fIdevice_name\fI\fR
file, or if the issuer of the \fBbutc\fR command included the \fB\-noautoquery\fR
flag, the Tape Coordinator instead expects the tape to be in the device
already.  If it is not, the Tape Coordinator invokes the \f(CW\*(C`MOUNT\*(C'\fR
instruction or prompts the operator. It also invokes the \f(CW\*(C`MOUNT\*(C'\fR
instruction or prompts for any additional tapes needed to complete the
operation; the backup operator must arrange to provide them.
.SH "OPTIONS"
.IX Header "OPTIONS"
.IP "\fB\-portoffset\fR <\fI\s-1TC\s0 port offset\fR>" 4
.IX Item "-portoffset <TC port offset>"
Specifies the port offset number of the Tape Coordinator handling the
tapes for this operation.
.IP "\fB\-archive\fR <\fIdate time\fR>+" 4
.IX Item "-archive <date time>+"
Specifies a date and time; volume dump records with earlier timestamps are
deleted from the disk copy of the Backup Database after the Backup System
dumps the database (a dump's timestamp appears in the \f(CW\*(C`created\*(C'\fR field of
the output from the \fBbackup dumpinfo\fR command). However, if a dump set
contains any dump created after the specified date, none of the dump
records associated with the dump set are deleted. Dump records for
previous dumps of the database (created with the \fBbackup savedb\fR command)
are never deleted; use the \fBbackup deletedump\fR command to remove them.
.Sp
Provide one of two values:
.RS 4
.IP "\(bu" 4
The string \f(CW\*(C`NOW\*(C'\fR to indicate the current date and time, in which case the
Backup System deletes all dump records except those for dumps of the
Backup Database itself.
.IP "\(bu" 4
A date value in the format \fImm/dd/yyyy\fR [\fIhh:MM\fR]. The month (\fImm\fR),
day (\fIdd\fR), and year (\fIyyyy\fR) are required, and valid values for the
year range from \f(CW1970\fR to \f(CW2037\fR; higher values are not valid because
the latest possible date in the standard \s-1UNIX\s0 representation is in
February 2038. The Backup System automatically reduces any later date to
the maximum value.
.Sp
The hour and minutes (\fIhh:MM\fR) are optional, but if provided must be in
24\-hour format (for example, the value \f(CW\*(C`14:36\*(C'\fR represents 2:36 p.m.). If
omitted, the time defaults to 59 seconds after midnight (00:00:59
hours). Similarly, the \fBbackup\fR command interpreter automatically adds 59
seconds to any time value provided. In both cases, adding 59 seconds
compensates for how the Backup Database and \fBbackup dumpinfo\fR command
represent dump creation times in hours and minutes only. That is, the
Database records a creation timestamp of \f(CW\*(C`20:55\*(C'\fR for any dump created
between 20:55:00 and 20:55:59. Automatically adding 59 seconds to a time
thus includes the records for all dumps created during that minute.
.RE
.RS 4
.RE
.IP "\fB\-localauth\fR" 4
.IX Item "-localauth"
Constructs a server ticket using a key from the local
\&\fI/usr/afs/etc/KeyFile\fR file. The \fBbackup\fR command interpreter presents
it to the Backup Server, Volume Server and \s-1VL\s0 Server during mutual
authentication. Do not combine this flag with the \fB\-cell\fR argument. For
more details, see \fIbackup\fR\|(8).
.IP "\fB\-cell\fR <\fIcell name\fR>" 4
.IX Item "-cell <cell name>"
Names the cell in which to run the command. Do not combine this argument
with the \fB\-localauth\fR flag. For more details, see \fIbackup\fR\|(8).
.IP "\fB\-help\fR" 4
.IX Item "-help"
Prints the online help for this command. All other valid options are
ignored.
.SH "EXAMPLES"
.IX Header "EXAMPLES"
The following example writes a copy of the Backup Database to the tape
device controlled by the Tape Coordinator with port offset 1:
.PP
.Vb 1
\&   % backup savedb \-portoffset 1
.Ve
.SH "PRIVILEGE REQUIRED"
.IX Header "PRIVILEGE REQUIRED"
The issuer must be listed in the \fI/usr/afs/etc/UserList\fR file on every
machine where the Backup Server is running, or must be logged onto a
server machine as the local superuser \f(CW\*(C`root\*(C'\fR if the \fB\-localauth\fR flag is
included.
.SH "SEE ALSO"
.IX Header "SEE ALSO"
\&\fIbutc\fR\|(5),
\&\fIbackup\fR\|(8),
\&\fIbackup_dbverify\fR\|(8),
\&\fIbackup_restoredb\fR\|(8),
\&\fIbutc\fR\|(8)
.SH "COPYRIGHT"
.IX Header "COPYRIGHT"
\&\s-1IBM\s0 Corporation 2000. <http://www.ibm.com/> All Rights Reserved.
.PP
This documentation is covered by the \s-1IBM\s0 Public License Version 1.0.  It was
converted from \s-1HTML\s0 to \s-1POD\s0 by software written by Chas Williams and Russ
Allbery, based on work by Alf Wachsmann and Elizabeth Cassell.
